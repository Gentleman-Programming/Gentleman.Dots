#!/usr/bin/env sh

# Yabai configuration migrated from AeroSpace

# Load scripting addition (required for native space switching with SIP partially disabled)
sudo yabai --load-sa
yabai -m signal --add event=dock_did_restart action="sudo yabai --load-sa"

# global settings - visual enhancements
yabai -m config mouse_follows_focus          on
yabai -m config focus_follows_mouse          off
yabai -m config window_origin_display        default
yabai -m config window_placement             second_child
yabai -m config window_shadow                on
yabai -m config window_opacity               on
yabai -m config window_opacity_duration      0.2
yabai -m config active_window_opacity        1.0
yabai -m config normal_window_opacity        0.95
yabai -m config window_animation_duration    0.25
yabai -m config window_animation_easing      ease_out_circ
yabai -m config insert_feedback_color        0xff61afef
yabai -m config split_ratio                  0.50
yabai -m config auto_balance                 off
yabai -m config mouse_modifier               fn
yabai -m config mouse_action1                move
yabai -m config mouse_action2                resize
yabai -m config mouse_drop_action            swap

# simple-bar integration
yabai -m config external_bar                 all:28:0

# simple-bar-server refresh signals (via curl - much faster than osascript)
yabai -m signal --add event=window_focused action="curl -s http://localhost:7776/yabai/windows/refresh" label="Refresh windows on focus"
yabai -m signal --add event=window_destroyed action="curl -s http://localhost:7776/yabai/windows/refresh" label="Refresh windows on close"
yabai -m signal --add event=window_created action="curl -s http://localhost:7776/yabai/windows/refresh" label="Refresh windows on create"
yabai -m signal --add event=space_changed action="curl -s http://localhost:7776/yabai/spaces/refresh" label="Refresh spaces on change"
yabai -m signal --add event=application_activated action="curl -s http://localhost:7776/yabai/windows/refresh" label="Refresh windows on app activate"

# general space settings - beautiful spacing
yabai -m config layout                       bsp
yabai -m config top_padding                  10
yabai -m config bottom_padding               6
yabai -m config left_padding                 6
yabai -m config right_padding                6
yabai -m config window_gap                   6

# space labels
# Display 1 (LG TV - Main): spaces 1-4
# Space 5: temporary/extra
# Space 6 (alt+6): Elgato Teleprompter
# Space 7 (alt+7): Arzopa Portable Monitor
yabai -m space 1 --label social 2>/dev/null || true
yabai -m space 2 --label work 2>/dev/null || true
yabai -m space 3 --label development 2>/dev/null || true
yabai -m space 4 --label others 2>/dev/null || true
yabai -m space 5 --label five 2>/dev/null || true
yabai -m space 6 --label teleprompter 2>/dev/null || true
yabai -m space 7 --label arzopa 2>/dev/null || true

# window rules - Finder floating (matching aerospace config)
yabai -m rule --add app="^Finder$" manage=off

echo "yabai configuration loaded.."
